var Tokensearch=function(e,t){if(!e||0===e.length)throw new Error("Empty collection!");if(this.collection=e,t=t||{},this.delimiter=t.delimiter||Tokensearch.defaultOptions.delimiter,this.maxFilterTokenEntries=t.maxFilterTokenEntries||Tokensearch.defaultOptions.maxFilterTokenEntries,this.defaultThreshold=t.threshold||Tokensearch.defaultOptions.threshold,this.collectionKeys=t.collectionKeys||Tokensearch.defaultOptions.collectionKeys,0===this.collectionKeys.length)throw new Error("No collectionKeys defined!");this.collectionDataTokenSize=this.collectionKeys.length,this._prepareSearchTokens()};Tokensearch.defaultOptions={delimiter:/[\s-]+/,threshold:.7,maxFilterTokenEntries:5,collectionKeys:[]},Tokensearch.prototype._prepareSearchTokens=function(){var e=this;this.collection.forEach(function(t){var o=[];e.collectionKeys.forEach(function(r){t[r].trim().toLowerCase().split(e.delimiter).forEach(function(e){o=o.concat(e)})}),t.dataEntryTokens=o.filter(e._onlyUnique)})},Tokensearch.prototype._onlyUnique=function(e,t,o){return o.indexOf(e)===t},Tokensearch.prototype.search=function(e,t){for(var o=[],r=t||this.defaultThreshold,n=e.trim().split(this.delimiter).filter(this._onlyUnique),i=0,s=Math.min(n.length,this.maxFilterTokenEntries);s>i;i++)o.push(n[i].toLowerCase());var c=[],l=0;this.collection.forEach(function(e){var t=0,r=0;e.dataEntryTokens.forEach(function(e){for(var n=o.length,i=0;n>i;i++){var s=o[i];if(e.indexOf(s)>-1){r++,t+=e===s?2:1;break}}}),r&&(t+=r,t>l&&(l=t),c.push({item:e,score:t}))});var h=[],a=1/l;return c.forEach(function(e){e.score=1-e.score*a,e.score<=r&&h.push(e)}),h.sort(function(e,t){return e.score-t.score})},module.exports=Tokensearch;