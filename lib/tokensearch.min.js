var Tokensearch=function(e,t){if(this.collection=e,t=t||{},this.delimiter=t.delimiter||Tokensearch.defaultOptions.delimiter,this.maxFilterTokenEntries=t.maxFilterTokenEntries||Tokensearch.defaultOptions.maxFilterTokenEntries,this.threshold=t.threshold||Tokensearch.defaultOptions.threshold,this.collectionKeys=t.collectionKeys||Tokensearch.defaultOptions.collectionKeys,0===this.collectionKeys.length)throw new Error("No collectionKeys defined!");if(!this.collection||0===this.collection.length)throw new Error("Empty collection!");this.collectionDataTokenSize=this.collectionKeys.length,this._prepareSearchTokens()};Tokensearch.defaultOptions={delimiter:" ",threshold:.7,maxFilterTokenEntries:5,collectionKeys:[]},Tokensearch.prototype._prepareSearchTokens=function(){var e=this;this.collection.forEach(function(t){var o=[];e.collectionKeys.forEach(function(n){t[n].trim().toLowerCase().split(e.delimiter).forEach(function(e){o.push(e)})}),t.dataEntryTokens=o.filter(e._onlyUnique)})},Tokensearch.prototype._onlyUnique=function(e,t,o){return o.indexOf(e)===t},Tokensearch.prototype.search=function(e,t){for(var o=[],n=t||this.threshold,i=e.trim().split(this.delimiter).filter(this._onlyUnique),r=0,s=Math.min(i.length,this.maxFilterTokenEntries);s>r;r++)o.push(i[r].toLowerCase());var c=[],l=0;this.collection.forEach(function(e){var t=0,n=0;e.dataEntryTokens.forEach(function(e){o.forEach(function(o){n++,e.indexOf(o)>-1&&(t+=e===o?2:1)})}),t&&(t>l&&(l=t),c.push({item:e,score:t}))});var h=[],a=1/l;return c.forEach(function(e){e.score=1-e.score*a,e.score<=n&&h.push(e)}),h.sort(function(e,t){return e.score-t.score})},module.exports=Tokensearch;